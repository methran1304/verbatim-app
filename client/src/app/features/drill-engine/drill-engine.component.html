<div class="drill-page drill-engine-center" (click)="focusInput()">
  <app-drill-toolbar
    [wpm]="wpm"
    [accuracy]="accuracy"
    [remainingSeconds]="timerState?.remainingSeconds || 0"
    [currentWordIndex]="currentWordIndex"
    [totalWords]="sourceText.length"
    [drillPreference]="drillPreferences"
    [isTyping]="isTyping"
    [disabled]="showPostDrillOverlay"
    [forceCollapsed]="showPostDrillOverlay"
    [showAdaptiveDrillOverlay]="showAdaptiveDrillOverlay"
    [currentDrillType]="drillPreferences.drillType"
    (restart)="onRestart()"
    (newDrill)="onNewDrill()"
    (viewErrorWords)="onViewErrorWords()"
    (drillPreferenceChange)="onDrillPreferenceChange($event)"
  ></app-drill-toolbar>

  <app-drill-text
    [sourceText]="sourceText"
    [typedInput]="typedText"
    [currentWordIndex]="currentWordIndex"
    [currentCharIndex]="currentCharIndex"
    [isFocused]="isInputFocused"
    [showPostDrillOverlay]="showPostDrillOverlay"
    [showAdaptiveDrillOverlay]="showAdaptiveDrillOverlay"
    [isSubmitting]="isSubmitting"
    [submitError]="submitError"
    [isUserInactive]="isUserInactive"
    [hasBeenInactive]="hasBeenInactive"
    [afkReason]="afkReason"
    [isGeneratingAdaptive]="isGeneratingAdaptive"
    [isLoadingErrorWords]="isLoadingErrorWords"
    (postDrillRestart)="onRestart()"
    (postDrillSubmit)="onPostDrillSubmit()"
    (generateAdaptiveDrill)="onGenerateAdaptiveDrill()"
    (viewErrorProneWords)="onViewErrorProneWords()"
  ></app-drill-text>

  @if (!isCompetitive) {
  <app-virtual-keyboard [inputValue]="currentInput" [isDarkTheme]="isDarkMode">
  </app-virtual-keyboard>
  }

  @if (isDrillActive) {
  <app-drill-input (keyTyped)="onKeyTyped($event)" (focusEvent)="onInputFocus()"
    (blurEvent)="onInputBlur()"></app-drill-input>
  }
</div>

<!-- Adaptive Drill Modal -->
<app-adaptive-drill-modal
  [isVisible]="showErrorWordsModal"
  [errorProneWords]="errorProneWords"
  [isLoading]="isLoadingErrorWords"
  (closeModal)="onCloseErrorWordsModal()">
</app-adaptive-drill-modal>