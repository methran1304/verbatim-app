<div class="profile-container">
  <!-- profile content -->
  <div class="profile-content">
    
    <!-- header section -->
    <div class="profile-header">
      <div class="profile-avatar">
        <div class="avatar-placeholder">
          {{ getAvatarInitial() }}
        </div>
      </div>
      
      <div class="profile-info">
        <h1 class="username">{{ profileStats?.username || 'User' }}</h1>
        <p class="email">{{ profileStats?.emailAddress || 'user@example.com' }}</p>
        <p class="member-since">Member since {{ getMemberSinceFormatted() }}</p>
      </div>
      
      <div class="profile-stats-summary">
        <div class="stat-card">
          <div class="stat-value">{{ profileStats?.userPoints || 0 }}</div>
          <div class="stat-label">Points</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ profileStats?.totalDrillsParticipated || 0 }}</div>
          <div class="stat-label">Drills</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ getTotalTimeFormatted() }}</div>
          <div class="stat-label">Time</div>
        </div>
      </div>
    </div>

    <!-- navigation tabs -->
    <div class="profile-tabs">
      <button 
        *ngFor="let tab of ['overview', 'performance']"
        [class.active]="activeTab === tab"
        (click)="setActiveTab(tab)"
        class="tab-button"
      >
        {{ tab.charAt(0).toUpperCase() + tab.slice(1) }}
      </button>
    </div>

    <!-- tab content -->
    <div class="tab-content">
      
      <!-- overview tab -->
      <div *ngIf="activeTab === 'overview'" class="overview-tab">
        <div class="overview-grid">
          
          <!-- key performance metrics -->
          <div class="metric-section">
            <h3>Performance Highlights</h3>
            <div class="metrics-grid">
              <div class="metric-card success">
                <div class="metric-header">
                  <span class="metric-title">Max WPM</span>
                </div>
                <div class="metric-value" [style.color]="getWPMColor()">
                  {{ getRoundedMaxWPM() }}
                </div>
                <div class="metric-subtitle">Personal Best</div>
              </div>
                            
              <div class="metric-card success">
                <div class="metric-header">
                  <span class="metric-title">Avg WPM</span>
                </div>
                <div class="metric-value" [style.color]="getWPMColor()">
                  {{ getRoundedAvgWPM() }}
                </div>
                <div class="metric-subtitle">Average Performance</div>
              </div>

              <div class="metric-card primary">
                <div class="metric-header">
                  <span class="metric-title">Max Accuracy</span>
                </div>
                <div class="metric-value" [style.color]="getAccuracyColor()">
                  {{ getRoundedMaxAccuracy() }}%
                </div>
                <div class="metric-subtitle">Personal Best</div>
              </div>
              
              <div class="metric-card primary">
                <div class="metric-header">
                  <span class="metric-title">Avg Accuracy</span>
                </div>
                <div class="metric-value" [style.color]="getAccuracyColor()">
                  {{ getRoundedAvgAccuracy() }}%
                </div>
                <div class="metric-subtitle">Average Performance</div>
              </div>
              
              <div class="metric-card error">
                <div class="metric-header">
                  <span class="metric-title">Error Rate</span>
                </div>
                <div class="metric-value" style="color: #ff4d4f;">
                  {{ getErrorRate() }}%
                </div>
                <div class="metric-subtitle">Typing Errors</div>
              </div>
            </div>
          </div>



          <!-- activity summary -->
          <div class="metric-section">
            <h3>Activity Summary</h3>
                          <div class="activity-metrics">
                <div class="activity-metric-card">
                  <div class="metric-header">
                    <span class="metric-title">Total Words</span>
                  </div>
                  <div class="metric-value">{{ profileStats?.totalWords?.toLocaleString() || 0 }}</div>
                  <div class="metric-subtitle">Words Typed</div>
                </div>
                
                <div class="activity-metric-card">
                  <div class="metric-header">
                    <span class="metric-title">Total Letters</span>
                  </div>
                  <div class="metric-value">{{ profileStats?.totalLetters?.toLocaleString() || 0 }}</div>
                  <div class="metric-subtitle">Letters Typed</div>
                </div>
                
                <div class="activity-metric-card">
                  <div class="metric-header">
                    <span class="metric-title">Total Drills</span>
                  </div>
                  <div class="metric-value">{{ profileStats?.totalDrillsParticipated || 0 }}</div>
                  <div class="metric-subtitle">Drills Completed</div>
                </div>
                
                <div class="activity-metric-card">
                  <div class="metric-header">
                    <span class="metric-title">Practice Time</span>
                  </div>
                  <div class="metric-value">{{ getTotalTimeFormatted() }}</div>
                  <div class="metric-subtitle">Time Spent</div>
                </div>
              </div>
          </div>
        </div>
      </div>

      <!-- performance tab -->
      <div *ngIf="activeTab === 'performance'" class="performance-tab">
        <!-- time range selector -->
        <div class="performance-header">
          <h3>Performance Trends</h3>
          <div class="time-range-selector">
            <button 
              *ngFor="let range of timeRangeOptions"
              [class.active]="selectedTimeRange === range"
              (click)="onTimeRangeChange(range)"
              class="range-button"
            >
              {{ range.charAt(0).toUpperCase() + range.slice(1) }}
            </button>
          </div>
        </div>

        <!-- metrics over time line chart -->
        <div class="metrics-line-chart-section">
          <div class="chart-card">
            <div class="chart-title">Performance Over Time</div>
            <div class="chart-container">
              <ngx-charts-line-chart
                [results]="metricsLineChartData"
                [scheme]="lineChartColorScheme"
                [xAxis]="true"
                [yAxis]="true"
                [legend]="true"
                [showXAxisLabel]="true"
                [showYAxisLabel]="true"
                [xAxisLabel]="'Date'"
                [yAxisLabel]="'Value'"
                [timeline]="false"
                [autoScale]="true"
                [curve]="curve"
                [animations]="true"
                [rangeFillOpacity]="0.1"
                [gradient]="false">
              </ngx-charts-line-chart>
            </div>
          </div>
        </div>

        <!-- drill distribution charts -->
        <div class="charts-container">
          <div class="chart-item">
            <div class="chart-card">
              <div class="chart-title">Drill Types</div>
              <div class="chart-container">
                <ngx-charts-bar-vertical
                  [results]="drillTypeChartData"
                  [scheme]="drillTypeColorScheme"
                  [xAxis]="true"
                  [yAxis]="true"
                  [gradient]="false"
                  [showXAxisLabel]="true"
                  [showYAxisLabel]="true"
                  [xAxisLabel]="'Drill Type'"
                  [yAxisLabel]="'Count'">
                </ngx-charts-bar-vertical>
              </div>
            </div>
          </div>
          
          <div class="chart-item">
            <div class="chart-card">
              <div class="chart-title">Difficulty Levels</div>
              <div class="chart-container">
                <ngx-charts-bar-vertical
                  [results]="difficultyChartData"
                  [scheme]="difficultyColorScheme"
                  [xAxis]="true"
                  [yAxis]="true"
                  [gradient]="false"
                  [showXAxisLabel]="true"
                  [showYAxisLabel]="true"
                  [xAxisLabel]="'Difficulty'"
                  [yAxisLabel]="'Count'">
                </ngx-charts-bar-vertical>
              </div>
            </div>
          </div>
        </div>

        <!-- competitive performance -->
        <div class="competitive-performance-section">
          <div class="chart-card">
            <div class="chart-title">Competitive Performance</div>
            <div class="wins-losses-progress">
              <div class="progress-header">
                <span class="wins-label">Wins</span>
                <span class="losses-label">Losses</span>
              </div>
              <div class="progress-bar-container">
                <div class="wins-bar" [style.width.%]="getWinRate()"></div>
                <div class="losses-bar" [style.width.%]="getLossRate()"></div>
                <div class="progress-divider"></div>
              </div>
                              <div class="progress-stats">
                  <span class="wins-count">{{ profileStats?.wins || 0 }}</span>
                  <span class="total-count">Total: {{ profileStats?.competitiveDrills || 0 }}</span>
                  <span class="losses-count">{{ profileStats?.losses || 0 }}</span>
                </div>
            </div>
          </div>
        </div>

        <!-- activity heatmap -->
        <div class="activity-heatmap-section">
          <div class="chart-card">
            <div class="chart-title">Daily Activity</div>
            
            <!-- month carousel -->
            <div class="month-carousel">
              <button class="carousel-btn prev" (click)="previousMonth()" title="Previous Month">
                <span>&lt;</span>
              </button>
              
              <div class="month-selector">
                <button 
                  *ngFor="let month of availableMonths"
                  [class.active]="selectedMonth === month"
                  (click)="selectMonth(month)"
                  class="month-btn"
                >
                  {{ month }}
                </button>
              </div>
              
              <button class="carousel-btn next" (click)="nextMonth()" title="Next Month">
                <span>&gt;</span>
              </button>
            </div>
            
            <div class="chart-container">
              @if (activityHeatmapData.length > 0) {
                <ngx-charts-heat-map
                  [results]="activityHeatmapData"
                  [scheme]="heatmapColorScheme"
                  [xAxis]="true"
                  [legend]="true"
                  [yAxis]="true"
                  [gradient]="false"
                  class="heatmap-chart">
                </ngx-charts-heat-map>
              }
            </div>
          </div>
        </div>
      </div>


    </div>
  </div>
</div>
